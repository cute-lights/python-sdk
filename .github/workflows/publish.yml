# This file is autogenerated by maturin v1.7.0
# To update, run
#
#    maturin generate-ci github
#
name: CI

on:
    push:
        tags:
            - "*"
    pull_request:

permissions:
    contents: write

jobs:
    linux:
        runs-on: ${{ matrix.platform.runner }}
        strategy:
            matrix:
                platform:
                    - runner: ubuntu-latest
                      target: x86_64
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-python@v5
              with:
                  python-version: 3.x

            - name: Bump version
              uses: tj-actions/cargo-bump@v3
            - name: Commit changes
              run: |
                  git config --local user.email "github-actions[bot]@users.noreply.github.com"
                  git config --local user.name "github-actions[bot]"
                  git add Cargo.toml
                  git add Cargo.lock
                  git commit -m "Bump version"
                  git push origin HEAD:main

            - name: Install Rust stable toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: stable
                  override: true

            - name: Install maturin
              run: python -m pip install maturin[patchelf]

            - name: Build wheels
              run: maturin build --release --no-sdist

            - name: Publish to PyPI
              shell: bash
              run: |
                  maturin publish --non-interactive --skip-existing target/wheels/*.whl
              env:
                  MATURIN_PYPI_TOKEN: ${{ secrets.PYPI_API_TOKEN }}
